/*!
 * RallyDev Extension Bookmarklet v0.6
 *
 * Copyright 2014 Miroslav Sommer
 * Released under the MIT license
 *
 * Date: 2014-06-11T23:00Z
 *
 * Add this bookmarklet to your browser bookmarks:
 *
 * javascript:$.getScript('https://rawgit.com/mirogta/rallydev-extension-bookmarklet/master/rallydevbookmarklet.min.js');
 *
 */
console.log=function(n,t,i){var u=i('<div id="_icon">RallyDev Extensions v0.5<\/div>'),r,f;u.appendTo("#footer");u.css({position:"fixed",bottom:"12px",right:"30px",padding:"2px",background:"#000",color:"#fff",border:"1px inset #aaa"});r=i('<div id="_logger"><\/div>');r.appendTo("#footer");r.css({position:"fixed",bottom:"12px",right:"30px",padding:"4px",background:"#fff",border:"1px inset #aaa",width:"1000px",height:"100px",overflow:"auto"});f=27;r.hide();i(n).on("keyup",function(n){n.keyCode===f&&r.toggle()});return function(n){var i=new Date;r.append("<small>"+i.toISOString()+"<\/small>:"+n+"<br/>");t.call(console,n);r[0].scrollTop=r[0].scrollHeight}}(window.document,console.log,$);console.log("Starting Miro's RallyDev Extension v0.5"),function(n){function i(){console.log("- Add extensions menu");var n=$('<li class="nav-tab" id="_extensionMenuItem"><a href="#/extensions">Extensions<\/a><\/li>');$(".nav-bar li").parent().append(n);n.on("click",function(n){return n.preventDefault(),$(".nav-bar li").removeClass("nav-tab-active"),u(),!1})}function u(){console.log("- Display extensions content");var i="https://rally1.rallydev.com/slm/webservice/v2.0/project/"+t.project.ObjectID,n='<div class="portlet">';n+='<div class="titlebar"><span>RallyDev Extensions<\/span><\/div><br/>';n+='<div>Current Project: <a href="'+i+'">'+t.project.Name+"<\/a><\/div>";n+='<div>Releases: <select id="_releases"><\/select><\/div>';n+='<hr/><div id="_stories"><\/div>';n+="<\/div>";setTimeout(r,0);$("#content .portlet").parent().html(n);$("#_releases").on("change",f)}function f(){var n=$(this).val(),i="?query=((Project.Name%20%3D%20BUD)%20AND(Release.ObjectID%20%3D%20"+n+"))&shallowFetch=Name,FormattedID,ObjectID,Tasks&pagesize=50&order=Name%20desc";$.getJSON("https://rally1.rallydev.com/slm/webservice/v2.0/HierarchicalRequirement"+i,function(n){var i=[],r=n.QueryResult.Results;$.each(r,function(n,r){var f="https://rally1.rallydev.com/#/"+t.project.ObjectID+"ud/detail/userstory/"+r.ObjectID,u=r.FormattedID;i.push('<li id="_'+u+'"><a href="'+f+'">'+u+"<\/a> "+r.Name+"<\/option>");r.Tasks&&r.Tasks.Count>0&&setTimeout(function(){e(u,r.ObjectID)},100)});$("#_stories").html(i.join(""))})}function r(){var n="https://rally1.rallydev.com/slm/webservice/v2.0/project/"+t.project.ObjectID+"/Releases";$.getJSON(n+"?shallowFetch=Name,ObjectID&pagesize=50&order=Date%20desc",function(n){var t=[],i=n.QueryResult.Results;t.push("<option>Please select...<\/option>");$.each(i,function(n,i){t.push('<option value="'+i.ObjectID+'">'+i.Name+"<\/option>")});$("#_releases").html(t.join(""))})}function e(n,t){var i="https://rally1.rallydev.com/slm/webservice/v2.0/HierarchicalRequirement/"+t+"/Tasks";$.getJSON(i,function(t){var i=[],r=t.QueryResult.Results;i.push("<ul>");$.each(r,function(n,t){i.push("<li>"+t.Name+"<\/li>")});i.push("<\/ul>");$("#_"+n).append(i.join(""))})}function o(){$("#_extensionMenuItem").remove()}var t=n.getScope();i();window.extensions={init:i,reset:o,loadReleases:r}}(Rally)